<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sourcing - Event</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        /* Хедер */
        header {
            background-color: #4b0082;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        /* Основное содержимое */
        .main-content {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2,
        h3,
        h4 {
            margin-top: 0;
            color: #4b0082;
        }

        h2 {
            font-size: 2.5em;
            margin-top: 5px;
        }

        h3 {
            font-size: 1.5em;
        }

        h4 {
            font-size: 1.2em;
        }

        .event-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .form-section {
            margin-top: 1.5rem;
            padding: 15px;
            /* border: 2px solid #e0d0f0; */
            border-radius: 5px;
            background-color: #f9f5ff;
        }

        .form-section1 {
            margin-top: 1.5rem;
            padding: 15px;
            /* border: 2px solid #e0d0f0; */
            border-radius: 5px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
            padding: 15px;
            border: 1px solid #d3b8ff;
            border-radius: 5px;
            background-color: #fefcff;
            margin-bottom: 5px;
        }

        .form-group1 {
            flex: 1;
            min-width: 250px;
            padding: 15px;
            border: 1px solid #e3dfe4;
            border-radius: 5px;
            background-color: #fefcff;
            margin-bottom: 5px;
        }




        .budget-currency-group {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            width: 100%;
        }

        .budget-field {
            flex: 2;
        }

        .currency-field {
            flex: 1;
        }

        .role-field {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: medium;
            color: #424242;
        }

        .label-two {
            display: block;
            margin-bottom: 0px;
            font-weight: 100;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .required-field::after {
            content: " *";
            color: red;
        }

        button {
            padding: 8px 16px;
            background-color: #4b0082;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 10px;
            font-size: 0.9em;
        }

        button:hover {
            background-color: #6a1b9a;
        }

        button.secondary {
            background-color: #b5043f;
        }

        button.tndr-sbmt {
            background-color: #4233c9;
        }

        button.secondary:hover {
            background-color: #5a6268;
        }

        button.large {
            padding: 12px 30px;
            font-size: 1.1em;
        }

        button.small {
            padding: 5px 10px;
            font-size: 0.8em;
            margin-top: 5px;
        }

        button.analyze-btn {
            background-color: #0e9b3d;
        }

        .file-upload {
            margin: 20px 0;
            padding: 30px;
            border: 2px dashed #b388ff;
            border-radius: 8px;
            text-align: center;
            background-color: #f3e5ff;
            transition: all 0.3s ease;
        }

        .file-upload.dragover {
            background-color: #e6ceff;
            border-color: #9c64ff;
        }

        .file-upload.hidden {
            display: none;
        }

        .file-upload-title {
            color: #4b0082;
            font-size: 1.5em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .file-upload-subtitle {
            color: #42484e;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .file-upload label {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4b0082;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload label:hover {
            background-color: #6a1b9a;
        }

        .file-name {
            margin-top: 10px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .hidden {
            display: none;
        }

        /* СТАТУС-БАР */
        .status-bar {
            display: flex;
            position: relative;
            margin-top: 40px;
            padding-top: 20px;
        }

        .status-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background-color: lightgray;
            z-index: 0;
        }

        .status-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 4px;
            background-color: blue;
            z-index: 1;
            transition: width 0.5s ease;
            width: 0%;
        }

        /* Прогресс по шагам (1–4) */
        .status-bar[data-step="1"]::after {
            width: 25%;
        }

        .status-bar[data-step="2"]::after {
            width: 50%;
        }

        .status-bar[data-step="3"]::after {
            width: 75%;
        }

        .status-bar[data-step="4"]::after {
            width: 100%;
        }

        .status-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 2;
            font-weight: normal;
            color: black;
            transition: color 0.3s ease, font-weight 0.3s ease;
        }

        .status-step.active {
            font-weight: bold;
            color: blue;
        }

        /* Новый стиль для радио-кнопок в столбик */
        .radio-group-vertical {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .event-type-container {
            display: flex;
            gap: 30px;
            margin-top: 15px;
        }

        .event-type-column {
            flex: 1;
        }

        .add-text-btn {
            margin-top: 5px;
            background-color: #6c757d;
            padding: 7px 30px;
            margin-left: 10px;
            font-size: 0.9em;
        }

        .text-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .text-actions.hidden {
            display: none;
        }

        #participation-text.hidden {
            display: none;
        }

        .team-member-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .team-member-input input {
            flex: 1;
        }

        .member-action-btn {
            padding: 5px 8px;
            min-width: 30px;
            background-color: #4b0082;
        }

        .analyze-btn-container {
            text-align: center;
            margin: 20px 0;
        }

        .form-actions {
            margin-top: 30px;
        }

        /* Меню навигации */
        .nav-menu-container {
            margin: 20px 0;
            text-align: center;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: inline-flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-menu li {
            padding: 8px 12px;
            border-radius: 4px;
        }

        .nav-menu li a {
            color: #4b0082;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .nav-menu li.active {
            background-color: #e0d0f0;
        }

        .nav-menu li:hover {
            background-color: #e0d0f0;
        }

        /* Сообщение об успешном анализе */
        .analysis-success {
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background-color: #e8f5e9;
            text-align: center;
            border: 1px solid #c8e6c9;
            display: none;
        }

        .analysis-success i {
            color: #4caf50;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .analysis-success h3 {
            color: #2e7d32;
            margin: 10px 0;
        }

        .analysis-success p {
            color: #424242;
            margin: 5px 0;
        }

        .radio-group-horizontal {
            display: flex;
            gap: 70px;
            margin-top: 10px;
        }

        .radio-option-horizontal {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        /* Стили для двухколоночных полей в команде */
        .team-member-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .team-member-input input {
            flex: 1;
            min-width: 188px;
        }

        /* Увеличиваем расстояние между блоками условий */
        .condition-block {
            margin-bottom: 20px;
        }

        /* Добавляем стили для кастомной кнопки загрузки файла */
        .custom-file-input {
            display: inline-block;
            padding: 5px 12px;
            background-color: #4b0082;
            font-size: 0.9em;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 5px;
            font-weight: 100;
            height: 20px;
            width: 150px;
        }

        .custom-file-input:hover {
            background-color: #6a1b9a;
        }

        #participation-condition {
            display: none;
            /* Скрываем оригинальный инпут */
        }

        /* Стили для подсказок */
        .tooltip-icon {
            color: #4b0082;
            margin-left: 5px;
            cursor: help;
        }

        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 0;
            top: 100%;
            background: #fff;
            border: 1px solid #4b0082;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 16px !important;
            font-weight: normal;
            color: #4d3c3d;
            z-index: 1000;
            white-space: pre-wrap;
            min-width: 240px;
            text-align: left;
            line-height: 1.3;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Исправленные стили для полей участников */
        .team-member-input input[type="email"] {
            flex: 2;
        }

        .team-member-input select {
            flex: 1;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            top: calc(50% + 20px);
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 2px solid #4b0082;
            padding: 20px;
            border-radius: 8px;
            z-index: 2147483647;
            /* Максимальный возможный z-index */
            white-space: pre-wrap;
            width: 320px;
            text-align: left;
            line-height: 1.6;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            pointer-events: none;
            animation: tooltipFade 0.3s ease;
        }

        @keyframes tooltipFade {
            from {
                opacity: 0;
                transform: translate(-50%, -40%);
            }

            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }


        /* Блок Инструкции  */
        .title-container {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-right: 20px;
        }

        .instruction-btn {
            background: #ab0630;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: help;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1em;
            white-space: nowrap;
            margin-left: auto;
        }

        .instruction-btn:hover {
            background: #4a0315;
            transform: scale(1.05);
        }

        .instruction-overlay {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            z-index: 2147483647;
            display: none;
            min-width: 400px;
        }

        .instruction-content {
            background: white;
            border: 2px solid #ab0630;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            line-height: 30px;
        }

        .instruction-btn:hover+.instruction-overlay,
        .instruction-overlay:hover {
            display: block;
        }

        .instruction-content::before {
            content: '';
            position: absolute;
            bottom: 100%;
            right: 15px;
            border-width: 8px;
            border-style: solid;
            border-color: transparent transparent #4b0082 transparent;
        }

        .comment-sec {
            margin-top: 20px;
        }

        /* Добавляем стили для управления формами */
        .form-tab {
            display: none;
        }

        .form-tab.active {
            display: block;
        }

        .file-upload.small {
            padding: 15px;
            min-height: 80px;
        }

        .file-upload.small .file-upload-title {
            font-size: 1.1em;
        }

        .file-upload.small label.small {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .file-name.small {
            font-size: 0.8em;
        }

        /* Стили для синхронизации валюты */
        #goods-currency {
            background-color: #f0f0f0;
            cursor: not-allowed;
        }

        .add-section {
            position: relative;
            width: 200px;
        }

        .add-type-btn {
            width: 100%;
            padding: 10px;
            background-color: #4b0082;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .type-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 100;
            margin-top: 5px;
        }

        .type-dropdown.show {
            display: block;
        }

        .type-option {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .type-option:hover {
            background-color: #f5f5f5;
        }

        .lot-form.hidden {
            display: none;
        }

        /* Стили для файлового инпута */
        .file-upload.small label.small {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px 0;
        }

        /* Добавляем новые стили для товаров и услуг */
        .simple-file-upload {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-btn {
            display: inline-block;
            padding: 8px 20px;
            background-color: #4b0082;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9em;
        }

        .add-section {
            position: relative;
            width: 200px;
        }

        .type-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 100;
            margin-top: 5px;
        }

        .type-dropdown.show {
            display: block;
        }

        .type-option {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .lot-form {

            margin: 15px 0;
            padding: 15px;
            border: 2px solid #e0d0f0;
            border-radius: 8px;
            background: #ffffff;
        }



        .error {
            border-color: #ff0000 !important;
            box-shadow: 0 0 3px #ff0000;
        }

        .lot-form.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .file-upload.small {
            display: none;
        }

        .adding-label {
            background-color: #4b0082;
            color: white;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }

        .adding-label.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .lot-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .hidden {
            display: none !important;
        }

        .adding-label {
            background-color: #4b0082;
            color: white;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none;
            margin-bottom: 15px;
        }

        .lot-actions {
            margin-top: 20px;
            display: none;
            gap: 10px;
            justify-content: flex-end;
        }

        .lot-actions.visible {
            display: flex;
        }

        .adding-label.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .adding-title {
            background-color: #4b0082;
            color: white !important;
            padding: 12px 232%;
            /* Вертикальные отступы */
            width: 100%;
            /* Занимает всю ширину */
            text-align: center;
            /* Центрирование текста */
            border-radius: 4px;
            font-size: 1.1em;
            margin: 0 0 15px 0;
            /* Отступ снизу */
            display: none;
            transition: all 0.3s ease;
            box-sizing: border-box;
            /* Учитываем padding в ширине */
        }

        /* Для иконки внутри заголовка */
        .adding-title i {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .add-type-btn.hidden {
            display: none;
        }

        .type-dropdown {
            display: none;
            position: absolute;
            /* остальные стили... */
        }

        .type-dropdown.show {
            display: block;
        }

        .participant-block {
            border: 2px solid #e0d0f0;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background: #f9f5ff;
        }

        .participant-block h4 {
            color: #4b0082;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .add-participant-btn {
            margin-top: 10px;
            width: 100%;
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            background: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234b0082'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") no-repeat right 0.75rem center/12px 12px;
            padding-right: 2rem;
        }

        select:invalid {
            color: #6c757d;
        }

        /* Стили для таблицы участников */
        .participants-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            table-layout: auto;
            min-width: 100%;
            overflow-x: auto;
        }

        .participants-table th,
        .participants-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0d0f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            padding: 12px 15px;
            word-wrap: break-word;
            /* Перенос длинных слов */
            white-space: normal !important;
            /* Разрешаем перенос */
            overflow-wrap: break-word;
            /* Альтернатива для word-wrap */
        }

        .participants-table th {
            background-color: #4b0082;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .participants-table tr:hover {
            background-color: #f9f5ff;
        }

        .participants-table-container {
            overflow-x: auto;
            width: 100%;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* Стили для модального окна */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 500px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 1.5em;
            color: #4b0082;
        }

        .modal-form-group {
            margin-bottom: 15px;
        }

        .modal-form-group label {
            display: block;
            margin-bottom: 5px;
            color: #4b0082;
            font-weight: bold;
        }

        .modal-form-group input,
        .modal-form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .required-star {
            color: red;
            margin-left: 3px;
        }

        /* ЛОТЫ */

        .lot-header {
            background-color: #4b0082;
            /* Темно-фиолетовый */
            color: white;
            padding: 12px 20px;
            border-radius: 6px 6px 0 0;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
        }

        .lot-number {
            font-size: 1.1em;
            letter-spacing: 0.5px;
        }


        /* СРОКИ */

        .start-select {
            width: 100%;
            padding: 8px;
            border: 2px solid #4b0082;
            border-radius: 4px;
        }

        #custom-date-fields {
            background: #f8f5ff;
            padding: 10px;
            border-radius: 4px;
        }

        #custom-date-fields .form-row {
            margin: 0;
        }


        .timeline-container {
            padding: 20px 0;
        }

        .timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            height: 80px;
        }

        .timeline-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 4px;
            background: #450e69;
            z-index: 1;
        }

        .timeline-item {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timeline-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4b0082;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .timeline-label {
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }

        .timeline-label span:first-child {
            display: block;
            font-weight: bold;
            color: #4b0082;
            font-size: large;
            margin-top: 10px;
        }

        #start-date-label,
        #end-date-label {
            font-size: 12px;
            color: #888;
            font-size: medium;
            margin-top: 30px;
        }

        .timeline-item.submission {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .lot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
        }

        .delete-lot-btn {
            padding: 5px 10px;
            font-size: 0.8em;
            background-color: #b5043f !important;
        }

        .delete-lot-btn:hover {
            background-color: #7a0229 !important;
        }

        /* Стили для подтверждения загрузки */
        .upload-success-message {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 12px 20px;
            margin-top: 10px;
            animation: slideIn 0.3s ease;
        }

        .upload-success-message i {
            color: #4caf50;
            font-size: 1.5em;
        }

        .upload-details {
            display: flex;
            flex-direction: column;
        }

        .file-name-text {
            font-weight: 500;
            color: #2e7d32;
            font-size: 0.95em;
        }

        .file-status {
            color: #666;
            font-size: 0.85em;
            margin-top: 3px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Стили для drag and drop */
        .file-upload.dragover {
            background-color: #f0f5ff;
            border: 2px dashed #0051ff;
        }

        .file-name {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s;
        }

        /* Стили для модального окна подтверждения */
        .invitation-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0d0f0;
            border-radius: 6px;
            font-family: Arial, sans-serif;
            line-height: 1.5;
            margin: 10px 0;
            min-height: 200px;
            resize: vertical;
            background: #fff;
        }

        .invitation-textarea:focus {
            outline: none;
            border-color: #4b0082;
            box-shadow: 0 0 5px rgba(75, 0, 130, 0.3);
        }

        .modal-content h3 {
            border-bottom: 2px solid #4b0082;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <header>
        <h1>Система автоматизации тендеров</h1>
    </header>

    <div class="main-content">
        <section class="form-container">
            <div class="title-container">
                <h2 style="color: #0051ff;">Sourcing - Event #51659</h2>
                <div style="position: relative;">
                    <button class="instruction-btn">
                        <i class="fas fa-info-circle"></i>
                        Инструкция
                    </button>
                    <div class="instruction-overlay">
                        <div class="instruction-content">
                            <h3 style="color: #ab0630; margin: 0 0 15px 0; font-size: 1.3em;">📋 Инструкция</h3>
                            <ol style="padding-left: 20px; margin: 0 0 15px 0;">
                                <li>Загрузите файл с заданием тендера</li>
                                <li>Дождитесь автоматического ввода информации системой</li>
                                <li>Проверьте корректность ввода данных системой</li>
                                <li>Внесите оставшиеся данные</li>
                                <li>Запустите тендер</li>
                            </ol>
                            <p style="color: #666; margin: 0; font-size: 0.9em;">
                                ❗ Обязательные поля отмечены *
                            </p>
                        </div>
                    </div>
                </div>
            </div>


            <div class="status-bar" data-step="1">
                <div class="status-step active">Черновик</div>
                <div class="status-step">В процессе</div>
                <div class="status-step">Ожидает оценки</div>
                <div class="status-step">Закрыто</div>
            </div>
            <div class="event-status">
                <span>Статус: <span id="status-text">Черновик</span></span>
                <button id="edit-btn">Редактировать событие</button>
            </div>


            <div class="file-upload" id="file-upload-container">
                <div class="file-upload-title">Загрузите файл</div>
                <div style="color:#eb1010; font-size: large;" class="file-upload-subtitle"><b>Запрос на проведение
                        тендера в формате MSG</b></div>
                <input type="file" id="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.msg" style="display: none;">
                <label for="file-input"><i class="fas fa-upload"></i> Выберите файл</label>
                <div id="file-name" class="file-name">Или перетащите файл сюда</div>
            </div>

            <div class="analysis-success" id="analysis-success">
                <i class="fas fa-check-circle"></i>
                <h3>Анализ завершен успешно!</h3>
                <p>Данные из файла были автоматически подгружены в форму.</p>
                <p>Вы можете проверить информацию и подтвердить событие.</p>
            </div>

            <div class="analyze-btn-container">
                <button id="analyze-btn" class="analyze-btn large hidden"><i class="fas fa-search"></i>
                    Анализировать</button>
            </div>

            <!-- Меню навигации -->
            <div class="nav-menu-container">
                <ul class="nav-menu">
                    <li class="active" data-tab="general">
                        <a href="#"><i class="fas fa-info-circle"></i> Общие сведения</a>
                    </li>
                    <li data-tab="timeline">
                        <a href="#"><i class="fas fa-calendar-alt"></i> Сроки тендера</a>
                    </li>
                    <li data-tab="goods">
                        <a href="#"><i class="fas fa-boxes"></i> Товары и услуги</a>
                    </li>
                    <li data-tab="participants">
                        <a href="#"><i class="fas fa-users"></i> Участники</a>
                    </li>
                    <li data-tab="evaluation">
                        <a href="#"><i class="fas fa-star"></i> Оценка предложений</a>
                    </li>
                </ul>
            </div>

            <form id="general-form" class="form-tab active">
                <div class="form-section">
                    <h3>Общие сведения</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="event-name" class="required-field">Название события</label>
                            <input type="text" id="event-name" name="event-name" required>
                        </div>
                        <div class="form-group">
                            <label for="participation-condition">Условия участия в тендере</label>
                            <label class="custom-file-input" for="participation-condition">
                                <i class="fas fa-upload"></i> Загрузить файл
                            </label>
                            <input type="file" id="participation-condition" name="participation-condition">

                            <div class="upload-success-message hidden" id="condition-upload-success">
                                <i class="fas fa-check-circle"></i>
                                <div class="upload-details">
                                    <span class="file-name-text" id="condition-file-name"></span>
                                    <span class="file-status">Файл успешно загружен</span>
                                </div>
                            </div>
                            <button type="button" class="add-text-btn" id="add-text-btn">
                                <i class="fas fa-plus"></i> Добавить текст
                            </button>
                            <textarea id="participation-text" name="participation-text" class="hidden"
                                style="margin-top: 10px;"></textarea>
                            <div class="text-actions hidden" id="text-actions">
                                <button type="button" class="small secondary" id="clear-text-btn">
                                    <i class="fas fa-trash"></i> Удалить текст
                                </button>
                                <button type="button" class="small secondary" id="cancel-text-btn">
                                    <i class="fas fa-times"></i> Отменить
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="purchase-category" class="required-field">Категория закупки</label>
                            <select id="mainCategory" onchange="updateSubCategories()">
                                <option value="">Выберите основную категорию</option>
                                <option value="CS">CS - PROFESSIONAL SERVICES</option>
                                <option value="MK">MK - MARKETING & SALES</option>
                                <option value="CD">CD - COGS & DISTRIBUTION</option>
                                <option value="MC">MC - CAPEX & MAINTENANCE</option>
                                <option value="DG">DG - DIGITAL</option>
                                <option value="RD">RD - MEDICAL & SCIENTIFIC</option>
                            </select>

                            <!-- Подкатегории -->
                            <select style="margin-top: 15px;" id="subCategory" disabled>
                                <option value="">Сначала выберите основную категорию</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Финансовая информация</h3>
                    <div class="form-row">
                        <div class="budget-currency-group">
                            <div class="form-group budget-field">
                                <label for="purchase-budget" class="required-field">Бюджет покупки</label>
                                <input type="text" id="purchase-budget" name="purchase-budget">
                            </div>
                            <div class="form-group currency-field">
                                <label for="currency" class="required-field">Валюта</label>
                                <select id="currency" name="currency" required>
                                    <option value="">Выберите валюту</option>
                                    <option value="RUB">RUB - Российский рубль</option>
                                    <option value="USD">USD - Доллар США</option>
                                    <option value="EUR">EUR - Евро</option>
                                    <option value="CNY">CNY - Китайский юань</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" style="width: 100%;">
                            <label for="planned-savings">Планируемая экономия</label>
                            <input type="text" id="planned-savings" name="planned-savings">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Бизнес-команда</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="business-partner" class="required-field">Бизнес-партнер</label>
                            <input type="text" id="business-partner" name="business-partner">
                        </div>
                        <div class="form-group">
                            <label for="tender-team">Команда тендера</label>
                            <div id="team-members-container">
                                <div class="team-member-input">
                                    <input type="email" placeholder="Email участника">
                                    <select>
                                        <option value="">Роль</option>
                                        <option value="owner">Владелец</option>
                                        <option value="watcher">Наблюдатель</option>
                                    </select>
                                    <button type="button" class="member-action-btn add-member-btn"><i
                                            class="fas fa-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 data-tooltip="RFP: Подробные предложения, сложные проекты&#10;RFI: Сбор информации, разведка рынка&#10;RFQ: Запрос цен, простые закупки&#10;Аукцион: Соревнование предложений, публичная продажа/закупка"
                        class="required-field">Параметры тендера
                        <i class="fas fa-question-circle tooltip-icon"></i>
                    </h3>

                    <div class="event-type-container">
                        <div class="event-type-column">
                            <h4>Тип события</h4>
                            <div class="radio-group-vertical">
                                <div class="radio-option">
                                    <input type="radio" id="type-rfp" name="event-type" value="rfp" required>
                                    <label for="type-rfp">RFP (Request for Proposal)</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="type-rfi" name="event-type" value="rfi">
                                    <label for="type-rfi">RFI (Request for Information)</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="type-rfq" name="event-type" value="rfq">
                                    <label for="type-rfq">RFQ (Request for Quotation)</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="type-auction" name="event-type" value="auction">
                                    <label for="type-auction">Аукцион</label>
                                </div>
                            </div>
                        </div>
                        <div class="event-type-column">
                            <h4>Условия</h4>
                            <div class="condition-block">
                                <label>Интервал изменения предложения: </label>
                                <div class="radio-group-horizontal">
                                    <div class="radio-option-horizontal">
                                        <input type="radio" id="param-option1-1" name="condition1" value="option1"
                                            required>
                                        <label class="label-two" for="param-option1-1">1 мин</label>
                                    </div>
                                    <div class="radio-option-horizontal">
                                        <input type="radio" id="param-option1-2" name="condition1" value="option2">
                                        <label class="label-two" for="param-option1-2">5 мин</label>
                                    </div>
                                    <div class="radio-option-horizontal">
                                        <input type="radio" id="param-option1-3" name="condition1" value="option3">
                                        <label class="label-two" for="param-option1-3">30 мин</label>
                                    </div>
                                </div>
                            </div>
                            <div class="condition-block">
                                <label>Шаг корректировки предложения, %: </label>
                                <div class="radio-group-horizontal">
                                    <div class="radio-option-horizontal">
                                        <input type="radio" id="param-option2-1" name="condition2" value="option1"
                                            required>
                                        <label class="label-two" for="param-option2-1">1%</label>
                                    </div>
                                    <div class="radio-option-horizontal">
                                        <input type="radio" id="param-option2-2" name="condition2" value="option2">
                                        <label class="label-two" for="param-option2-2">2%</label>
                                    </div>
                                    <div class="radio-option-horizontal">
                                        <input type="radio" id="param-option2-3" name="condition2" value="option3">
                                        <label class="label-two" for="param-option2-3">5%</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="comment-sec">
                    <h3>Комментарии</h3>
                    <textarea id="comments" name="comments" placeholder="Введите комментарий..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" id="save-btn">Сохранить</button>
                    <button type="button" id="submit-btn" class="tndr-sbmt hidden">Подтвердить</button>
                    <button type="button" class="secondary">Отмена</button>
                </div>
            </form>

            <!-- Сроки тендера -->
            <form id="timeline-form" class="form-tab">
                <div class="form-section">
                    <h3>Сроки тендера</h3>
                    <div class="form-row">
                        <!-- Начало тендера -->
                        <div class="form-group" style="flex: 1; border:0px;">
                            <label style="font-size: large;" for="start-type">Начало тендера</label>
                            <select id="start-type" class="start-select" required>
                                <option value="">Выберите тип</option>
                                <option value="immediate">Сразу после подтверждения</option>
                                <option value="custom">Назначить дату и время</option>
                            </select>

                            <!-- Контейнер для дополнительных полей -->
                            <div id="custom-date-fields" style="display: none; margin-top: 10px;">
                                <div class="form-row" style="gap: 0px; ">
                                    <div class="form-group" style="flex: 1; margin-bottom: 0px; border: 0px;">
                                        <label style="color:#7c7979" for="end-date">Дата начала</label>
                                        <input type="date" id="start-date" style="width: 100%;">
                                    </div>
                                    <div class="form-group" style="flex: 1; border: 0px;">
                                        <label style="color:#7c7979" for="end-date">Время начала</label>
                                        <input type="time" id="start-time" style="width: 100%;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Окончание тендера -->
                        <div class="form-group" style="flex: 1;border:0px;">
                            <label style="font-size: large; margin-bottom: 25px;" for="start-type">Окончание
                                тендера</label>

                            <label style="margin-bottom: 15px; color: #695b6d" for="start-type">Назначить дату и время
                                окончания</label>
                            <div class="form-row" style="gap: 10px; margin-top: 0;">
                                <div class="form-group" style="flex: 1; border: 0px; margin-bottom: -1px;">
                                    <label style="color:#7c7979" for="end-date">Дата окончания</label>
                                    <input type="date" id="end-date" required style="width: 100%">
                                </div>
                                <div class="form-group" style="flex: 1; border: 0px;">
                                    <label style="color:#7c7979" for="end-time">Время окончания</label>
                                    <input type="time" id="end-time" required style="width: 100%">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="form-section1">
                    <h3>Таймлайн тендера</h3>
                    <div class="timeline-container">
                        <div class="timeline">
                            <div class="timeline-item start">
                                <div class="timeline-dot"></div>
                                <div class="timeline-label">
                                    <span>Начало</span>
                                    <span id="start-date-label">—</span>
                                </div>
                            </div>

                            <div class="timeline-item submission">
                                <div class="timeline-dot"></div>
                                <div class="timeline-label">
                                    <span>Подача предложений</span>
                                </div>
                            </div>

                            <div class="timeline-line"></div>

                            <div class="timeline-item end">
                                <div class="timeline-dot"></div>
                                <div class="timeline-label">
                                    <span>Окончание</span>
                                    <span id="end-date-label">—</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Общие элементы формы -->
                <div class="comment-sec">
                    <h3>Комментарии</h3>
                    <textarea id="comments-timeline" name="comments"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" id="save-timeline">Сохранить</button>
                    <button type="button" class="secondary">Отмена</button>
                </div>
            </form>

            <form id="goods-form" class="form-tab">
                <div class="form-section">
                    <h3>Документация к тендеру</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label style="margin-bottom: 10px">Вложения</label>
                            <div class="simple-file-upload">
                                <input type="file" id="goods-file" class="hidden">
                                <label for="goods-file" class="upload-btn">
                                    <i class="fas fa-upload"></i> Выбрать файл
                                </label>
                                <!-- Добавленный блок подтверждения -->
                                <div class="upload-success-message hidden" id="goods-upload-success">
                                    <i class="fas fa-check-circle"></i>
                                    <div class="upload-details">
                                        <span class="file-name-text" id="goods-file-name"></span>
                                        <span class="file-status">Файл успешно загружен</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Товары и услуги</h3>
                    <div class="lots-container" id="lots-container">
                        <!-- Лоты будут добавляться сюда -->
                    </div>

                    <div class="add-section">
                        <button type="button" class="add-type-btn" id="add-type-btn">
                            <i class="fas fa-plus"></i> Добавить
                        </button>
                        <div class="type-dropdown">
                            <div class="type-option" data-type="lot">Лот</div>
                            <div class="type-option" data-type="service">Услуга</div>
                        </div>
                    </div>
                </div>
                <div class="comment-sec">
                    <h3>Комментарии</h3>
                    <textarea id="comments-goods" name="comments"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" id="save-goods">Сохранить</button>
                    <button type="button" class="secondary">Отмена</button>
                </div>
            </form>

            <!-- Шаблон для услуги -->
            <template id="service-template">
                <div class="service-form">
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label class="required-field">Название услуги</label>
                            <input type="text" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Описание услуги</label>
                            <input type="text">
                        </div>
                    </div>
                    <div class="service-actions">
                        <button type="button" class="save-service">Сохранить</button>
                        <button type="button" class="cancel-service secondary">Отмена</button>
                    </div>
                </div>
            </template>
            <!-- Шаблон лота -->
            <template id="lot-template">
                <div class="lot-form">
                    <!-- Заголовок лота -->
                    <div class="lot-header">
                        <span class="lot-number"></span>
                        <button class="delete-lot-btn secondary small">
                            <i class="fas fa-trash"></i> Удалить лот
                        </button>
                    </div>

                    <!-- Строка 1 -->
                    <div class="form-row">
                        <div class="form-group1">
                            <label class="required-field">Название лота</label>
                            <input type="text" required>
                        </div>
                        <div class="form-group1">
                            <label>Описание лота</label>
                            <input type="text">
                        </div>
                    </div>

                    <!-- Строка 2 -->
                    <div class="form-row">
                        <div class="form-group1">
                            <label class="required-field">Количество</label>
                            <input type="number" required>
                        </div>
                        <div class="form-group1">
                            <label>Единица измерения</label>
                            <select>
                                <option value="">Выберите</option>
                                <option value="шт">Штуки</option>
                                <option value="кг">Килограммы</option>
                                <option value="м">Метры</option>
                            </select>
                        </div>
                    </div>

                    <!-- Строка 3 -->
                    <div class="form-row">
                        <div class="form-group1">
                            <label class="required-field">Стартовая цена</label>
                            <input type="number" step="0.01" required>
                        </div>
                        <div class="form-group1">
                            <label>Валюта</label>
                            <select>
                                <option value="RUB">Рубли</option>
                                <option value="USD">Доллары</option>
                                <option value="EUR">Евро</option>
                            </select>
                        </div>
                    </div>

                    <div class="lot-actions">
                        <button type="button" class="save-lot">Сохранить</button>
                        <button type="button" class="cancel-lot secondary">Отмена</button>
                    </div>
                </div>
            </template>
            <!--  раздел Participants -->
            <form id="participants-form" class="form-tab">
                <div class="form-section">
                    <h3>Участники тендера</h3>
                    <div class="participants-table-container">
                        <table class="participants-table">
                            <thead>
                                <tr>
                                    <th>Дата добавления</th>
                                    <th>Название</th>
                                    <th>Контакт</th>
                                    <th>Email</th>
                                    <th>Участие</th>
                                    <th>Последняя активность</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="participants-table-body">
                                <!-- Строки будут добавляться здесь -->
                            </tbody>
                        </table>
                    </div>

                    <button type="button" class="add-participant-btn secondary" id="open-modal-btn">
                        <i class="fas fa-plus-circle"></i> Добавить участника
                    </button>
                </div>
                <div class="comment-sec">
                    <h3>Комментарии</h3>
                    <textarea id="comments-participants" name="comments"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" id="save-participants">Сохранить</button>
                    <button type="button" class="secondary">Отмена</button>
                </div>
            </form>

            <!-- Модальное окно -->
            <div class="modal-overlay" id="modal-overlay">
                <div class="modal-content">
                    <span class="modal-close" id="modal-close">&times;</span>
                    <h3 style="color: #4b0082; margin-top: 0;">Добавить участника</h3>

                    <form id="participant-form">
                        <div class="modal-form-group">
                            <label>Название компании <span class="required-star">*</span></label>
                            <input type="text" id="modal-company" required>
                        </div>

                        <div class="modal-form-group">
                            <label>Контактное лицо <span class="required-star">*</span></label>
                            <input type="text" id="modal-contact" required>
                        </div>

                        <div class="modal-form-group">
                            <label>Email <span class="required-star">*</span></label>
                            <input type="email" id="modal-email" required>
                        </div>

                        <div class="modal-form-group">
                            <label>Условия участия</label>
                            <select id="modal-terms">
                                <option value="accepted">Принято</option>
                                <option value="pending">В ожидании</option>
                                <option value="rejected">Отклонено</option>
                            </select>
                        </div>

                        <div style="text-align: right; margin-top: 20px;">
                            <button type="button" class="secondary" id="modal-cancel">Отмена</button>
                            <button type="submit" class="tndr-sbmt">Добавить</button>
                        </div>
                    </form>
                </div>
            </div>

            <form id="evaluation-form" class="form-tab">
                <div class="form-section">
                    <h3>Способ оценки предложений</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="min-score" class="required-field">Минимальная оценка</label>
                            <select id="min-score" name="min-score" required>
                                <option value="">Выберите</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="max-score" class="required-field">Максимальная оценка</label>
                            <select id="max-score" name="max-score" required>
                                <option value="">Выберите</option>
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="comment-sec">
                    <h3>Комментарии</h3>
                    <textarea id="comments-evaluation" name="comments"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" id="save-evaluation">Сохранить</button>
                    <button type="button" class="secondary">Отмена</button>
                </div>
            </form>
        </section>

        <!-- Модальное окно подтверждения -->
        <div class="modal-overlay" id="confirm-modal">
            <div class="modal-content" style="width: 600px;">
                <span class="modal-close" onclick="closeConfirmModal()">&times;</span>
                <h3 style="color: #4b0082; margin-top: 0;">Подтвердите запуск тендера</h3>

                <div class="modal-form-group">
                    <label>Приглашение для участия</label>
                    <textarea id="invitation-text" class="invitation-textarea"></textarea>
                </div>

                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="secondary" onclick="closeConfirmModal()">Отмена</button>
                    <button type="button" class="tndr-sbmt" onclick="submitTender()">Отправить</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        let lotCounter = 0;


        const categoriesData = {
            "CS": [
                "CS2001 - Car fleet",
                "CS5004 - Office Products",
                "CS5005 - FM Occupant Services",
                "CS5006 - FM Building Services",
                "CS5008 - Security Services and Products",
                "CS5025 - FM Building Services",
                "CS5026 - FM Occupant Services",
                "CS5027 - Garments and Safety Products",
                "CS5028 - Security Services and Products",
                "CS5029 - FM Building Services",
                "CS5030 - Integrated Facility Management",
                "CS5032 - Real Estate and Workplace",
                "CS5033 - Subscription and Translation",
                "CS5034 - Subscription and Translation",
                "CS5035 - FM Occupant Services",
                "CS5036 - Subscription and Translation",
                "CS5037 - FM Occupant Services",
                "CS5038 - FM Building Services",
                "CS5039 - FM Occupant Services",
                "CS5040 - Security Services and Products",
                "CS5041 - Garments and Safety Products",
                "CS5042 - Garments and Safety Products",
                "CS6001 - Consulting",
                "CS6002 - Consulting",
                "CS6003 - Consulting",
                "CS6004 - Consulting",
                "CS2004 - Travel",
                "CS2006 - Travel",
                "CS2008 - Travel",
                "CS2009 - Travel",
                "CS2012 - CONTINGENCY WORKFORCE",
                "CS2022 - CONTINGENCY WORKFORCE",
                "CS2013 - HR Project",
                "CS2014 - Learning and Development",
                "CS2015 - Recruitment and Outplacement",
                "CS2016 - Recruitment and Outplacement",
                "CS2017 - Compensation and Benefits",
                "CS2018 - Compensation and Benefits",
                "CS2019 - Car fleet",
                "CS2020 - Car fleet",
                "CS2021 - Car fleet",
                "CS5023 - Real Estate and Workplace",
                "CS5024 - Real Estate and Workplace",
                "CS5031 - Real Estate and Workplace",
                "CS6005 - Consulting",
                "CS6006 - Outsourcing & Shared Services",
                "CS6007 - Insurances",
                "CS6008 - Insurances",
                "CS6009 - Insurances",
                "CS6010 - Insurances",
                "CS6011 - Financial Services"
            ],
            "MK": [
                "MK1018 - Media Buy",
                "MK3001 - Market Data & Insights",
                "MK4001 - Promotional Items, Displays",
                "MK4002 - Promotional Items, Displays",
                "MK1004 - Communication Agencies",
                "MK1005 - Media Buy",
                "MK1006 - Media Buy",
                "MK1007 - Communication Agencies",
                "MK1012 - Communication Agencies",
                "MK1013 - Communication Agencies",
                "MK1014 - Communication Agencies",
                "MK1015 - Communication Agencies",
                "MK1017 - Media Buy",
                "MK1019 - Media Buy",
                "MK1020 - Communication Agencies",
                "MK1021 - Communication Agencies",
                "MK2001 - Meetings, Events",
                "MK2003 - Meetings, Events",
                "MK2006 - Meetings, Events",
                "MK2007 - Meetings, Events",
                "MK2008 - Meetings, Events",
                "MK2009 - Meetings, Events",
                "MK2010 - Meetings, Events",
                "MK2011 - Meetings, Events",
                "MK2012 - Meetings, Events",
                "MK2013 - Meetings, Events",
                "MK2014 - Meetings, Events",
                "MK3002 - Market Data & Insights",
                "MK3004 - Call centers & Patient Support Program (PSP)",
                "MK3009 - Call centers & Patient Support Program (PSP)",
                "MK3010 - Market Data & Insights",
                "MK3011 - Patients, Physicians & Payers Data",
                "MK4003 - Prints",
                "MK4004 - Prints",
                "MK5003 - Medical Operations",
                "MK5004 - Medical Operations",
                "MK5005 - Medical Operations",
                "MK6001 - Sales services",
                "MK6002 - External Sales Force",
                "MK6003 - Market access"
            ],
            "CD": [
                "CD1001 - Raw Materials (all Businesses)",
                "CD1002 - Raw Materials (all Businesses)",
                "CD1003 - Raw Materials (all Businesses)",
                "CD1004 - Raw Materials (all Businesses)",
                "CD1005 - Raw Materials (all Businesses)",
                "CD1006 - Raw Materials (all Businesses)",
                "CD1007 - Raw Materials (all Businesses)",
                "CD1008 - Raw Materials (all Businesses)",
                "CD1009 - Raw Materials (all Businesses)",
                "CD1010 - Raw Materials (all Businesses)",
                "CD1011 - Raw Materials (all Businesses)",
                "CD1012 - Eggs",
                "CD2002 - API + Excipients (Pharma)",
                "CD2003 - API + Excipients (Pharma)",
                "CD2004 - API + Excipients (Pharma)",
                "CD2005 - API + Excipients (Pharma)",
                "CD3001 - Carboard/paper",
                "CD3002 - Carboard/paper",
                "CD3003 - Carboard/paper",
                "CD3004 - Carboard/paper",
                "CD3005 - Carboard/paper",
                "CD3006 - Devices",
                "CD3007 - Devices",
                "CD3008 - Devices",
                "CD3009 - Devices",
                "CD3010 - Devices",
                "CD3011 - Glass",
                "CD3012 - Devices",
                "CD3013 - Devices",
                "CD3014 - Glass",
                "CD3015 - Devices",
                "CD3016 - Devices",
                "CD3017 - Metal",
                "CD3018 - Metal",
                "CD3019 - Metal",
                "CD3020 - Plastics",
                "CD3021 - Plastics",
                "CD3022 - Plastics",
                "CD3023 - Plastics",
                "CD3024 - Plastics",
                "CD3025 - Plastics",
                "CD3026 - Plastics",
                "CD3027 - Plastics",
                "CD3028 - Devices",
                "CD3029 - Other Packaging",
                "CD3030 - Devices",
                "CD6001 - Production Consumables",
                "CD6002 - Production Consumables",
                "CD4001 - Subcontracting full services",
                "CD4002 - Subcontracting toll",
                "CD4003 - Subcontracting toll",
                "CD4004 - Subcontracting toll",
                "CD4005 - Subcontracting toll",
                "CD4006 - Subcontracting toll",
                "CD4007 - Subcontracting toll",
                "CD4008 - Subcontracting toll",
                "CD4009 - Subcontracting under license",
                "CD4010 - Subcontracting under license",
                "CD4011 - Subcontracting under license",
                "CD5002 - Distribution Subcontracting",
                "CD5003 - COGS Freight & Duties",
                "CD5004 - Packaging & Consumables for Distribution",
                "CD5006 - COGS Freight & Duties",
                "CD5007 - COGS Freight & Duties",
                "CD5008 - COGS Freight & Duties",
                "CD5009 - COGS Freight & Duties",
                "CD5010 - Distribution Subcontracting",
                "CD5011 - COGS Freight & Duties",
                "CD5012 - COGS Freight & Duties"
            ],
            "MC": [
                "MC1001 - Major Bio & Chemistry Equipment",
                "MC1002 - Major Bio & Chemistry Equipment",
                "MC1003 - Building and infrastructure",
                "MC1004 - Building and infrastructure",
                "MC1005 - Building and infrastructure",
                "MC1006 - Building and infrastructure",
                "MC1009 - Capex Project Engineering",
                "MC1010 - Water, Waste & Energy Production Assets",
                "MC1012 - Manufacturing process equipment",
                "MC1013 - Process control systems",
                "MC1014 - Process control systems",
                "MC1015 - Process piping",
                "MC1017 - Secondary works",
                "MC1018 - Secondary works",
                "MC1019 - Secondary works",
                "MC1020 - Secondary works",
                "MC1021 - Storage and handling equipment",
                "MC1022 - Major Bio & Chemistry Equipment",
                "MC1023 - Manufacturing process equipment",
                "MC1024 - Manufacturing process equipment",
                "MC1025 - Process control systems",
                "MC1026 - Capex Project Engineering",
                "MC1027 - Capex Project Engineering",
                "MC1028 - Manufacturing process equipment",
                "MC1029 - Manufacturing process equipment",
                "MC1030 - Storage and handling equipment",
                "MC1031 - Laboratory Secondary Works and Furniture",
                "MC1032 - Capex Project Engineering",
                "MC1033 - Water, Waste & Energy Production Assets",
                "MC1034 - Water, Waste & Energy Production Assets",
                "MC2001 - Industrial maintenance, services",
                "MC2002 - Industrial maintenance, services",
                "MC2003 - Industrial maintenance, services",
                "MC2004 - Tools and spares",
                "MC2005 - Tools and spares",
                "MC2006 - Tools and spares",
                "MC2007 - Tools and spares",
                "MC2008 - Tools and spares",
                "MC2009 - Tools and spares",
                "MC2010 - Tools and spares",
                "MC2014 - Industrial maintenance, services",
                "MC3001 - Energy Consumption",
                "MC3002 - Fluids Consumption",
                "MC3003 - Energy Consumption",
                "MC3004 - Energy Consumption",
                "MC3005 - Energy Consumption",
                "MC3007 - Fluids Consumption",
                "MC3009 - Waste Recycling and Remediation",
                "MC3010 - Waste Recycling and Remediation",
                "MC3011 - Waste Recycling and Remediation",
                "MC2011 - Tools and spares",
                "MC2012 - Tools and spares",
                "MC2013 - Tools and spares"
            ],
            "DG": [
                "CS4002 - Software",
                "CS4003 - Hardware",
                "CS4004 - IT services",
                "CS4005 - IT services",
                "CS4006 - Software",
                "CS4010 - IT services",
                "CS4011 - IT services",
                "CS4012 - Hardware",
                "CS4013 - Hardware",
                "CS4015 - Software",
                "CS4016 - Telecom",
                "CS4017 - Telecom"
            ],
            "RD": [
                "RD1001 - Clinical & Medical Central Services",
                "RD1004 - Clinical & Medical Central Services",
                "RD1024 - Clinical & Medical Central Services",
                "RD1027 - Clinical & Medical Central Services",
                "RD1029 - Clinical Laboratories",
                "RD1030 - Clinical Laboratories",
                "RD1031 - Clinical Functional Service Provision",
                "RD1032 - Clinical Supply chain",
                "RD1033 - Clinical Supply chain",
                "RD1034 - Regulatory",
                "RD1035 - Regulatory",
                "RD1036 - Regulatory",
                "RD1037 - Regulatory",
                "RD1038 - Pharmacovigilance",
                "RD1039 - Pharmacovigilance",
                "RD1040 - Pharmacovigilance",
                "RD1041 - Clinical Laboratories",
                "RD1042 - Clinical Functional Service Provision",
                "RD1043 - Clinical Functional Service Provision",
                "RD1044 - Clinical Functional Service Provision",
                "RD1045 - Clinical Supply chain",
                "RD1046 - Clinical Studies",
                "RD1047 - Clinical Studies",
                "RD1048 - Clinical Studies",
                "RD1049 - Clinical Supply chain",
                "RD1050 - Clinical Supply chain",
                "RD1051 - RWE Studies",
                "RD2002 - Laboratory Supplies",
                "RD2003 - Laboratory Supplies",
                "RD2004 - Laboratory Supplies",
                "RD2005 - Laboratory Supplies",
                "RD2007 - Lab Equipment Repair & Maintenance",
                "RD2008 - Laboratory Equipment",
                "RD2009 - Laboratory Equipment",
                "RD2014 - Pharmaceuticals CMC",
                "RD2015 - Pharmaceuticals CMC",
                "RD2016 - Pre Clinical & Laboratory Studies",
                "RD2017 - Pre Clinical & Laboratory Studies",
                "RD2019 - Biopharmaceuticals CMC",
                "RD2020 - Biopharmaceuticals CMC",
                "RD2021 - Laboratory Supplies",
                "RD2022 - Laboratory Supplies"
            ]
        };

        window.updateSubCategories = function () {
            const mainSelect = document.getElementById("mainCategory");
            const subSelect = document.getElementById("subCategory");
            const selectedCategory = mainSelect.value;

            subSelect.innerHTML = '<option value="">Выберите подкатегорию</option>';
            subSelect.disabled = true;

            if (selectedCategory && categoriesData[selectedCategory]) {
                subSelect.disabled = false;
                categoriesData[selectedCategory].forEach(item => {
                    const option = document.createElement("option");
                    const [value, text] = item.split(' - ');
                    option.value = value.trim();
                    option.textContent = item;
                    subSelect.appendChild(option);
                });
            }
        };


        document.addEventListener('DOMContentLoaded', function () {
            // ================= ГЛОБАЛЬНЫЕ НАСТРОЙКИ =================
            let lotCounter = 0;
            let mockParticipants = [];

            // ================= ОСНОВНЫЕ ФУНКЦИИ =================

            // 1. Управление вкладками
            const setupTabHandlers = () => {
                document.querySelectorAll('.nav-menu li').forEach(item => {
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                        const tabId = this.dataset.tab;

                        document.querySelectorAll('.nav-menu li, .form-tab').forEach(el => {
                            el.classList.remove('active');
                        });

                        this.classList.add('active');
                        document.getElementById(`${tabId}-form`).classList.add('active');
                    });
                });
            };



            function updateSubCategories() {
                const mainSelect = document.getElementById("mainCategory");
                const subSelect = document.getElementById("subCategory");
                const selectedCategory = mainSelect.value;

                // Сброс подкатегорий
                subSelect.innerHTML = '<option value="">Выберите подкатегорию</option>';
                subSelect.disabled = true;

                if (selectedCategory) {
                    subSelect.disabled = false;
                    categoriesData[selectedCategory].forEach(item => {
                        const option = document.createElement("option");
                        const [value, text] = item.split(' - ');
                        option.value = value.trim();
                        option.textContent = item;
                        subSelect.appendChild(option);
                    });
                }
            };

            // 2. Работа с текстовым полем условий
            const setupParticipationText = () => {
                const addTextBtn = document.getElementById('add-text-btn');
                const textArea = document.getElementById('participation-text');
                const textActions = document.getElementById('text-actions');
                const clearBtn = document.getElementById('clear-text-btn');
                const cancelBtn = document.getElementById('cancel-text-btn');

                textArea.classList.add('hidden');
                textActions.classList.add('hidden');

                addTextBtn.addEventListener('click', () => {
                    textArea.classList.remove('hidden');
                    textActions.classList.remove('hidden');
                    addTextBtn.classList.add('hidden');
                });

                clearBtn.addEventListener('click', () => {
                    textArea.value = '';
                });

                cancelBtn.addEventListener('click', () => {
                    textArea.classList.add('hidden');
                    textActions.classList.add('hidden');
                    addTextBtn.classList.remove('hidden');
                });
            };

            // 3. Сроки тендера
            const setupTimelineSection = () => {
                const startTypeSelect = document.getElementById('start-type');
                const customDateFields = document.getElementById('custom-date-fields');
                const startDateInput = document.getElementById('start-date');
                const startTimeInput = document.getElementById('start-time');
                const endDateInput = document.getElementById('end-date');
                const endTimeInput = document.getElementById('end-time');
                const startDateLabel = document.getElementById('start-date-label');
                const endDateLabel = document.getElementById('end-date-label');

                const updateTimeline = () => {
                    if (startTypeSelect.value === 'custom' && startDateInput.value) {
                        const startDate = new Date(startDateInput.value);
                        let timeString = startTimeInput.value ? `, ${startTimeInput.value}` : '';
                        startDateLabel.textContent = startDate.toLocaleDateString('ru-RU') + timeString;
                    } else {
                        startDateLabel.textContent = 'Сразу после подтверждения';
                    }

                    if (endDateInput.value) {
                        const endDate = new Date(endDateInput.value);
                        let timeString = endTimeInput.value ? `, ${endTimeInput.value}` : '';
                        endDateLabel.textContent = endDate.toLocaleDateString('ru-RU') + timeString;
                    } else {
                        endDateLabel.textContent = '—';
                    }
                };

                startTypeSelect.addEventListener('change', function () {
                    customDateFields.style.display = this.value === 'custom' ? 'block' : 'none';
                    updateTimeline();
                });

                [startTypeSelect, startDateInput, startTimeInput, endDateInput, endTimeInput].forEach(
                    element => element.addEventListener('change', updateTimeline)
                );

                updateTimeline();
            };

            // 4. Товары и услуги
            const setupGoodsSection = () => {
                const addTypeBtn = document.getElementById('add-type-btn');
                const typeDropdown = document.querySelector('.type-dropdown');
                const lotsContainer = document.getElementById('lots-container');
                const lotTemplate = document.getElementById('lot-template');
                const serviceTemplate = document.getElementById('service-template');

                addTypeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    typeDropdown.classList.toggle('show');
                });

                document.querySelectorAll('.type-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const type = e.target.dataset.type;
                        typeDropdown.classList.remove('show');

                        if (type === 'lot') addLotForm();
                        if (type === 'service') addServiceForm();
                    });
                });

                document.addEventListener('click', (e) => {
                    if (!addTypeBtn.contains(e.target)) {
                        typeDropdown.classList.remove('show');
                    }
                });

                const addLotForm = () => {
                    const lotClone = lotTemplate.content.cloneNode(true);
                    const newLot = lotClone.querySelector('.lot-form');
                    lotCounter++;
                    newLot.querySelector('.lot-number').textContent = `Лот ${lotCounter}`;

                    newLot.querySelector('.delete-lot-btn').addEventListener('click', (e) => {
                        newLot.remove();
                        lotCounter--;
                        document.querySelectorAll('.lot-form').forEach((lot, index) => {
                            lot.querySelector('.lot-number').textContent = `Лот ${index + 1}`;
                        });
                    });

                    lotsContainer.appendChild(newLot);
                };

                const addServiceForm = () => {
                    const serviceClone = serviceTemplate.content.cloneNode(true);
                    const newService = serviceClone.querySelector('.service-form');

                    newService.querySelector('.cancel-service').addEventListener('click', () => {
                        newService.remove();
                    });

                    lotsContainer.appendChild(newService);
                };
                // Добавляем этот блок для работы с командой тендера
                const setupTeamMembers = () => {
                    const container = document.getElementById('team-members-container');

                    container.addEventListener('click', (e) => {
                        if (e.target.closest('.add-member-btn')) {
                            const template = container.querySelector('.team-member-input');
                            const newMember = template.cloneNode(true);
                            newMember.querySelector('input').value = '';
                            newMember.querySelector('select').selectedIndex = 0;
                            container.appendChild(newMember);
                        }
                    });
                };

                // Вызываем новую функцию
                setupTeamMembers();
            };

            // 5. Анализ основного файла
            // 5. Анализ основного файла (ЗАМЕНИТЬ ЭТУ ФУНКЦИЮ)
            const setupFileAnalysis = () => {
                const fileInput = document.getElementById('file-input');
                const analyzeBtn = document.getElementById('analyze-btn');
                const fileUploadContainer = document.getElementById('file-upload-container');
                const analysisSuccess = document.getElementById('analysis-success');
                const lotTemplate = document.getElementById('lot-template');
                const participantsTableBody = document.getElementById('participants-table-body');

                // Функция обновления статуса
                const updateStatus = (step) => {
                    const statusBar = document.querySelector('.status-bar');
                    const statusSteps = document.querySelectorAll('.status-step');

                    statusBar.setAttribute('data-step', step);
                    statusSteps.forEach((el, index) => {
                        index < step ? el.classList.add('active') : el.classList.remove('active');
                    });

                    const statusTexts = ['Черновик', 'В процессе', 'Ожидает оценки', 'Закрыто'];
                    document.getElementById('status-text').textContent = statusTexts[step - 1];
                };

                fileInput.addEventListener('change', () => {
                    analyzeBtn.classList.remove('hidden');
                });

                analyzeBtn.addEventListener('click', async () => {
                    analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Анализируется...';
                    analyzeBtn.disabled = true;

                    // Создаем объект FormData и добавляем файл
                    const formData = new FormData();
                    formData.append('file', fileInput.files[0]); // Добавляем файл из input

                    try {
                        //обращение к API
                        const response = await fetch('/api/analyze-file', {
                            method: 'POST',
                            body: formData,
                        });
                        if (!response.ok) throw new Error('Ошибка при обращении к API');

                        const data = await response.json();
                        console.log(data); // Логируем данные для отладки

                        // Заполнение общих сведений
                        document.getElementById('event-name').value = 'Закупка офисного оборудования 2024';
                        document.getElementById('participation-text').value = 'Требуется предоставить документы компании и лицензии.';

                        // Категории
                        document.getElementById('mainCategory').value = 'CS';
                        updateSubCategories();
                        setTimeout(() => {
                            document.getElementById('subCategory').value = 'CS5004';
                        }, 100);

                        // Финансовая информация
                        document.getElementById('purchase-budget').value = '500000';
                        document.getElementById('currency').value = 'RUB';
                        document.getElementById('planned-savings').value = '15%';

                        // Бизнес-команда
                        document.getElementById('business-partner').value = 'ООО Поставщик Экспресс';
                        const teamContainer = document.getElementById('team-members-container');
                        teamContainer.querySelector('input').value = 'procurement@company.com';
                        teamContainer.querySelector('select').value = 'owner';

                        // Параметры тендера
                        document.getElementById('type-rfp').checked = true;
                        document.getElementById('param-option1-2').checked = true; // 5 мин
                        document.getElementById('param-option2-2').checked = true; // 2%

                        // Комментарии
                        document.getElementById('comments').value = 'Тестовые данные для демонстрации';

                        // Сроки тендера
                        const endDate = new Date();
                        endDate.setDate(endDate.getDate() + 7);
                        document.getElementById('end-date').value = endDate.toISOString().split('T')[0];
                        document.getElementById('end-time').value = '18:00';

                        // Оценка предложений
                        document.getElementById('min-score').value = '0';
                        document.getElementById('max-score').value = '100';

                        // Добавление лотов (автоматически создаем их)
                        const lotsContainer = document.getElementById('lots-container');
                        lotsContainer.innerHTML = ''; // Очищаем контейнер

                        // Функция для добавления лота
                        const addLotForm = (name, description, quantity, unit, startPrice, currency) => {
                            const lotClone = lotTemplate.content.cloneNode(true);
                            const newLot = lotClone.querySelector('.lot-form');
                            lotCounter++;
                            // Заголовок лота
                            newLot.querySelector('.lot-number').textContent = `Лот ${lotCounter}`;

                            // Название лота
                            newLot.querySelector('.form-row:nth-child(2) .form-group1:nth-child(1) input').value = name;

                            // Описание лота
                            newLot.querySelector('.form-row:nth-child(2) .form-group1:nth-child(2) input').value = description;

                            // Количество
                            newLot.querySelector('.form-row:nth-child(3) .form-group1:nth-child(1) input').value = quantity;

                            // Единица измерения
                            const unitSelect = newLot.querySelector('.form-row:nth-child(3) .form-group1:nth-child(2) select');
                            if (unitSelect) unitSelect.value = unit;

                            // Стартовая цена
                            newLot.querySelector('.form-row:nth-child(4) .form-group1:nth-child(1) input').value = startPrice;

                            // Валюта
                            const currencySelect = newLot.querySelector('.form-row:nth-child(4) .form-group1:nth-child(2) select');
                            if (currencySelect) currencySelect.value = currency;


                            newLot.querySelector('.delete-lot-btn').addEventListener('click', (e) => {
                                newLot.remove();
                                lotCounter--;
                                document.querySelectorAll('.lot-form').forEach((lot, index) => {
                                    lot.querySelector('.lot-number').textContent = `Лот ${index + 1}`;
                                });
                            });

                            lotsContainer.appendChild(newLot);
                        };

                        // Добавляем лоты
                        addLotForm('Лот 1', 'Описание лота 1', 1, 'шт', 1000, 'RUB');
                        addLotForm('Лот 2', 'Описание лота 2', 2, 'кг', 500, 'USD');
                        addLotForm('Лот 3', 'Описание лота 3', 3, 'кг', 100, 'USD');
                        addLotForm('Лот 4', 'Описание лота 4', 4, 'кг', 200, 'RUB');
                        addLotForm('Лот 5', 'Описание лота 5', 5, 'кг', 300, 'USD');
                        addLotForm('Лот 6', 'Описание лота 6', 6, 'кг', 400, 'RUB');
                        addLotForm('Лот 7', 'Описание лота 7', 7, 'кг', 500, 'USD');
                        addLotForm('Лот 8', 'Описание лота 8', 8, 'кг', 600, 'USD');
                        addLotForm('Лот 9', 'Описание лота 9', 9, 'кг', 700, 'RUB');
                        addLotForm('Лот 10', 'Описание лота 10', 19, 'кг', 800, 'RUB');
                        addLotForm('Лот 11', 'Описание лота 11', 11, 'кг', 900, 'USD');
                        addLotForm('Лот 12', 'Описание лота 12', 12, 'кг', 100, 'USD');
                        addLotForm('Лот 13', 'Описание лота 13', 13, 'кг', 200, 'RUB');
                        addLotForm('Лот 14', 'Описание лота 14', 14, 'кг', 300, 'USD');
                        addLotForm('Лот 15', 'Описание лота 15', 5, 'кг', 550, 'USD');

                        // Добавление участников
                        const getStatusBadge = (status) => {
                            const badges = {
                                accepted: '<span style="color: green;"><i class="fas fa-check-circle"></i> Активно</span>',
                                pending: '<span style="color: orange;"><i class="fas fa-clock"></i> Ожидание</span>',
                                rejected: '<span style="color: red;"><i class="fas fa-times-circle"></i> Отклонено</span>'
                            };
                            return badges[status] || '';
                        };

                        const addParticipantToTable = (data) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                    <td>${new Date().toLocaleDateString()}</td>
                    <td>${data.company}</td>
                    <td>${data.contact}</td>
                    <td>${data.email}</td>
                    <td>${getStatusBadge(data.terms)}</td>
                    <td>Только что</td>
                    <td class="action-buttons">
                        <button class="small" onclick="editParticipant(this)"><i class="fas fa-edit"></i></button>
                        <button class="small secondary" onclick="deleteParticipant(this)"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                            participantsTableBody.appendChild(row);
                        };

                        // Добавляем участников
                        addParticipantToTable({ company: 'Компания 1', contact: 'Контакт 1', email: 'contact1@example.com', terms: 'accepted' });
                        addParticipantToTable({ company: 'Компания 2', contact: 'Контакт 2', email: 'contact2@example.com', terms: 'pending' });
                        addParticipantToTable({ company: 'Компания 3', contact: 'Контакт 3', email: 'contact3@example.com', terms: 'rejected' });

                        // Обновляем статус после анализа
                        updateStatus(2);

                        fileUploadContainer.classList.add('hidden');
                        analysisSuccess.style.display = 'block';
                        analyzeBtn.classList.add('hidden');
                        document.getElementById('submit-btn').classList.remove('hidden');

                    } catch (error) {
                        console.error(error);
                        alert("Произошла ошибка при анализе файла. Пожалуйста, попробуйте еще раз.");
                    } finally {
                        analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Анализировать';
                        analyzeBtn.disabled = false;
                    }
                });
            };

            // 6. Управление файлами
            const setupFileHandlers = () => {
                const handleFileUpload = (inputId, successId, fileNameId) => {
                    document.getElementById(inputId).addEventListener('change', function (e) {
                        const successMessage = document.getElementById(successId);
                        const fileNameSpan = document.getElementById(fileNameId);

                        if (this.files.length > 0) {
                            fileNameSpan.textContent = this.files[0].name;
                            successMessage.classList.remove('hidden');
                        } else {
                            successMessage.classList.add('hidden');
                        }
                    });
                };

                handleFileUpload('goods-file', 'goods-upload-success', 'goods-file-name');
                handleFileUpload('participation-condition', 'condition-upload-success', 'condition-file-name');
            };

            // 7. Управление участниками
            const setupParticipants = () => {
                const modalOverlay = document.getElementById('modal-overlay');
                const participantForm = document.getElementById('participant-form');
                const participantsTableBody = document.getElementById('participants-table-body');

                const getStatusBadge = (status) => {
                    const badges = {
                        accepted: '<span style="color: green;"><i class="fas fa-check-circle"></i> Активно</span>',
                        pending: '<span style="color: orange;"><i class="fas fa-clock"></i> Ожидание</span>',
                        rejected: '<span style="color: red;"><i class="fas fa-times-circle"></i> Отклонено</span>'
                    };
                    return badges[status] || '';
                };

                const addParticipantToTable = (data) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${new Date().toLocaleDateString()}</td>
                <td>${data.company}</td>
                <td>${data.contact}</td>
                <td>${data.email}</td>
                <td>${getStatusBadge(data.terms)}</td>
                <td>Только что</td>
                <td class="action-buttons">
                    <button class="small" onclick="editParticipant(this)"><i class="fas fa-edit"></i></button>
                    <button class="small secondary" onclick="deleteParticipant(this)"><i class="fas fa-trash"></i></button>
                </td>
            `;
                    participantsTableBody.appendChild(row);
                };

                document.getElementById('open-modal-btn').addEventListener('click', () => {
                    modalOverlay.style.display = 'flex';
                });

                document.getElementById('modal-close').addEventListener('click', () => {
                    modalOverlay.style.display = 'none';
                });

                document.getElementById('modal-cancel').addEventListener('click', () => {
                    modalOverlay.style.display = 'none';
                });

                participantForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const participantData = {
                        company: document.getElementById('modal-company').value,
                        contact: document.getElementById('modal-contact').value,
                        email: document.getElementById('modal-email').value,
                        terms: document.getElementById('modal-terms').value
                    };

                    addParticipantToTable(participantData);
                    modalOverlay.style.display = 'none';
                    this.reset();

                    const emailInput = document.getElementById('modal-email');
                    if (!validateEmail(emailInput.value)) {
                        alert('Введите корректный email адрес');
                        return;
                    }
                });
            };
            // 8. Управление отображением имени файла
            const setupFileUploadDisplay = () => {
                const fileInput = document.getElementById('file-input');
                const fileNameDiv = document.getElementById('file-name');
                const fileUploadContainer = document.getElementById('file-upload-container');

                // Обработчик для выбора файла через кнопку
                fileInput.addEventListener('change', function (e) {
                    if (this.files.length > 0) {
                        fileNameDiv.textContent = this.files[0].name;
                    }
                });

                // Обработчики для drag and drop
                fileUploadContainer.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUploadContainer.classList.add('dragover');
                });

                fileUploadContainer.addEventListener('dragleave', () => {
                    fileUploadContainer.classList.remove('dragover');
                });

                fileUploadContainer.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUploadContainer.classList.remove('dragover');

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        fileInput.files = files;
                        fileNameDiv.textContent = files[0].name;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
            };

            // ================= ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ =================
            const init = () => {
                setupTabHandlers();
                setupParticipationText();
                setupTimelineSection();
                setupGoodsSection();
                setupFileAnalysis();
                setupFileHandlers();
                setupParticipants();
                setupFileUploadDisplay();
            };

            init();
        });

        // Глобальные функции для действий с участниками
        window.deleteParticipant = function (btn) {
            const row = btn.closest('tr');
            row.parentNode.removeChild(row);
        };

        window.editParticipant = function (btn) {
            const row = btn.closest('tr');
            const cells = row.querySelectorAll('td');

            document.getElementById('modal-company').value = cells[1].textContent;
            document.getElementById('modal-contact').value = cells[2].textContent;
            document.getElementById('modal-email').value = cells[3].textContent;

            const status = cells[4].querySelector('span').textContent.includes('Активно') ? 'accepted' :
                cells[4].querySelector('span').textContent.includes('Ожидание') ? 'pending' : 'rejected';
            document.getElementById('modal-terms').value = status;

            document.getElementById('modal-overlay').style.display = 'flex';
        };


        // Функции для модального окна подтверждения
        function showConfirmModal() {
            const tenderName = document.getElementById('event-name').value;
            if (!tenderName) {
                alert('Пожалуйста, заполните название события в форме!');
                return;
            }

            document.getElementById('confirm-modal').style.display = 'flex';
            document.getElementById('invitation-text').value =
                `Уважаемый поставщик!\n\nКомпания N приглашает Вас для участия в тендере "${tenderName}". Со сроками и описанием закупки Вы сможете ознакомиться в системе проведения онлайн-тендеров. Будем рады видеть Вас в качестве активного участника закупки!`;
        }

        function closeConfirmModal() {
            document.getElementById('confirm-modal').style.display = 'none';
        }


        function submitTender() {
            // Закрываем модальное окно
            closeConfirmModal();

            // Показываем уведомление
            alert('Тендер успешно запущен!');

            // Переадресация на home.html через 1 секунду
            setTimeout(() => {
                window.location.href = 'home.html';
            }, 1000);

        }


        // Обновляем обработчик кнопки подтверждения
        document.getElementById('submit-btn').addEventListener('click', function () {
            updateStatus(3); // Устанавливаем статус "Ожидает оценки"
            showConfirmModal();
        });

        // Функция обновления статуса
        function updateStatus(step) {
            const statusBar = document.querySelector('.status-bar');
            const statusSteps = document.querySelectorAll('.status-step');

            statusBar.setAttribute('data-step', step);
            statusSteps.forEach((el, index) => {
                index < step ? el.classList.add('active') : el.classList.remove('active');
            });

            const statusTexts = ['Черновик', 'В процессе', 'Ожидает оценки', 'Закрыто'];
            document.getElementById('status-text').textContent = statusTexts[step - 1];
        }



    </script>
</body>

</html>